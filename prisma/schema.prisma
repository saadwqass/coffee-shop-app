generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =================================================================
// 1. Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Ø±
// =================================================================

enum Role {
  admin
  seller
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  passwordHash String 
  role         Role      @default(seller)
  name         String?   // <--- ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  shifts       Shift[]
  sales        Sale[]

  @@map("users")
}

// =================================================================
// 2. Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†
// =================================================================

model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  products    Product[] 

  @@map("categories")
}

model Product {
  id            String    @id @default(cuid())
  name          String    @unique
  description   String?
  price         Decimal   @db.Money  
  imageUrl      String?
  stock         Int       @default(0) 
  isAvailable   Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  categoryId    String
  category      Category  @relation(fields: [categoryId], references: [id])

  saleItems     SaleItem[]

  @@map("products")
}

// =================================================================
// 3. Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ÙˆØ±Ø¯ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
// =================================================================

// ØªØµÙ†ÙŠÙ Ø§Ù„ÙˆØ±Ø¯ÙŠØ©: ØµØ¨Ø§Ø­ÙŠ Ø£Ùˆ Ù…Ø³Ø§Ø¦ÙŠ
enum ShiftType { 
  morning
  evening
}

model Shift {
  id             String    @id @default(cuid())
  sellerId       String
  seller         User      @relation(fields: [sellerId], references: [id])
  startTime      DateTime  @default(now())
  endTime        DateTime?
  // ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ù„Ù†ÙˆØ¹ Ù„ÙŠØµØ¨Ø­ Enum
  shiftType      ShiftType 
  startingCash   Decimal   @db.Money @default(0)
  endingCash     Decimal?  @db.Money
  
  sales          Sale[]

  @@map("shifts")
}

// Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Sale)
model Sale {
  id             String      @id @default(cuid())
  saleTime       DateTime    @default(now())
  
  sellerId       String
  seller         User        @relation(fields: [sellerId], references: [id])
  shiftId        String
  shift          Shift       @relation(fields: [shiftId], references: [id])
  
  subtotal       Decimal     @db.Money
  vatAmount      Decimal     @db.Money
  feeAmount      Decimal     @db.Money
  totalAmount    Decimal     @db.Money
  
  paymentMethod  String      // 'cash', 'mada', 'visa_master'
  
  items          SaleItem[]

  @@map("sales")
}

// Ù†Ù…ÙˆØ°Ø¬ Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (SaleItem)
model SaleItem {
Â  idÂ  Â  Â  Â  Â  Â  Â StringÂ  Â  Â  @id @default(cuid())
Â Â 
Â  saleIdÂ  Â  Â  Â  Â String
Â  saleÂ  Â  Â  Â  Â  Â SaleÂ  Â  Â  Â  @relation(fields: [saleId], references: [id])
Â  productIdÂ  Â  Â  String
Â  productÂ  Â  Â  Â  ProductÂ  Â  Â @relation(fields: [productId], references: [id])
Â Â 
Â  productNameÂ  Â  String
Â  priceAtSaleÂ  Â  DecimalÂ  Â  Â @db.Money
Â  quantityÂ  Â  Â  Â Int
  // ðŸ† Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨!
  subtotal       Decimal     @db.Money 
Â Â 
Â  @@map("sale_items")
}